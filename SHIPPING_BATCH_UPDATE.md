# 🚚 운송장 일괄 처리 업데이트

**업데이트 일시**: 2025년 10월 15일  
**중요 개선**: 여러 주문 일괄 처리 시 각 주문마다 고유한 운송장 정보 자동 생성

---

## ✨ 주요 변경 사항

### 🎯 이전 동작의 문제점
❌ **여러 주문 선택 시 같은 운송장 번호가 모든 주문에 적용**
- 주문 3개 선택 → 운송장 번호 1개만 입력 → 모든 주문에 동일한 번호 적용
- **문제**: 각 주문은 고유한 운송장 번호를 가져야 함!

### ✅ 새로운 동작
✨ **각 주문마다 고유한 운송장 정보 자동 생성**
- 주문 3개 선택 → 배송 시작 클릭 → **3개의 고유한 운송장 번호 자동 생성**
- 각 주문의 채널에 맞는 택배사 자동 설정 (또는 선택한 택배사 일괄 적용)
- 각 주문의 고객명을 포함한 개별 배송 메모 생성

---

## 📊 동작 비교

### 단일 주문 선택 (1개)

**UI 상태**:
- ✅ 운송장 번호: 입력 가능 (자동 생성됨, 수정 가능)
- ✅ 택배사: 선택 가능
- ✅ 배송 메모: 입력 가능 (자동 생성됨, 수정 가능)
- ✅ 🔄 새로고침 버튼: 활성화

**배송 시작 시**:
```
주문 ORD-2025101501 (김민수)
├─ 운송장 번호: 20251015123456
├─ 택배사: CJ대한통운
├─ 배송일: 2025-10-15
├─ 예상 배송일: 2025-10-17
└─ 배송 메모: 김민수님 주문 - 안전하게 배송하겠습니다.
```

---

### 여러 주문 선택 (2개 이상)

**UI 상태**:
- 🔒 운송장 번호: **비활성화** (자동 생성 안내)
- ✅ 택배사: 선택 가능 (모든 주문에 동일하게 적용)
- ✅ 배송일/예상 배송일: 선택 가능 (모든 주문에 동일하게 적용)
- 🔒 배송 메모: **비활성화** (자동 생성 안내)
- 🔒 🔄 새로고침 버튼: 비활성화

**안내 메시지**:
```
ℹ️ 3개 주문이 선택되었습니다. 
   배송 시작 시 각 주문마다 고유한 운송장 번호가 자동 생성됩니다.
```

**배송 시작 시**:
```
주문 ORD-2025101501 (김민수)
├─ 운송장 번호: 20251015123456 ← 자동 생성
├─ 택배사: CJ대한통운 ← 사용자 선택 또는 채널별 기본값
├─ 배송일: 2025-10-15 ← 공통
├─ 예상 배송일: 2025-10-17 ← 공통
└─ 배송 메모: 김민수님 주문 - 안전하게 배송하겠습니다. ← 자동 생성

주문 ORD-2025101502 (이지은)
├─ 운송장 번호: 20251015847291 ← 자동 생성 (다른 번호!)
├─ 택배사: CJ대한통운 ← 동일
├─ 배송일: 2025-10-15 ← 동일
├─ 예상 배송일: 2025-10-17 ← 동일
└─ 배송 메모: 이지은님 주문 - 안전하게 배송하겠습니다. ← 자동 생성

주문 ORD-2025101503 (박상현)
├─ 운송장 번호: 20251015965432 ← 자동 생성 (또 다른 번호!)
├─ 택배사: CJ대한통운 ← 동일
├─ 배송일: 2025-10-15 ← 동일
├─ 예상 배송일: 2025-10-17 ← 동일
└─ 배송 메모: 박상현님 주문 - 안전하게 배송하겠습니다. ← 자동 생성
```

---

## 🎨 UI 변경 사항

### 1. 운송장 번호 필드

#### 단일 주문
```
┌────────────────────────────────────┐
│ 운송장 번호 *                      │ 🔄
│ [20251015123456          ]         │
└────────────────────────────────────┘
```

#### 여러 주문
```
┌────────────────────────────────────┐
│ 운송장 번호 (자동 생성)             │ 🔄
│ [배송 시작 시 각 주문마다 자동 생성] │ (비활성화)
│ ℹ️ 여러 주문 선택 시 각각 고유한     │
│    번호가 자동 생성됩니다            │
└────────────────────────────────────┘
```

### 2. 배송 메모 필드

#### 단일 주문
```
┌────────────────────────────────────┐
│ 배송 메모                          │
│ [김민수님 주문 -                   │
│  안전하게 배송하겠습니다.          │
│                                    │]
└────────────────────────────────────┘
```

#### 여러 주문
```
┌────────────────────────────────────┐
│ 배송 메모 (각 주문별 자동 생성)     │
│ [배송 시작 시 각 주문별로           │
│  고객명이 포함된 메모가 생성됩니다] │
│ ℹ️ 각 주문마다 '{고객명}님 주문 -   │
│    안전하게 배송하겠습니다'          │
│    형식으로 자동 생성                │
└────────────────────────────────────┘
```

### 3. 안내 메시지

#### 단일 주문
```
ℹ️ 주문 선택 시 운송장 정보가 자동으로 생성됩니다. 
   필요시 수정 가능합니다.
```

#### 여러 주문
```
ℹ️ 3개 주문이 선택되었습니다. 
   배송 시작 시 각 주문마다 고유한 운송장 번호가 자동 생성됩니다.
```

---

## 🔧 기술 구현 세부사항

### 자동 생성 로직

```typescript
const handleSubmitShipping = async () => {
  // 각 주문마다 고유한 운송장 정보 생성
  const updatePromises = Array.from(selectedOrders).map(orderId => {
    const order = orders.find(o => o.id === orderId);
    
    // 1. 각 주문마다 고유한 운송장 번호
    const uniqueTrackingNumber = generateTrackingNumber();
    
    // 2. 채널에 맞는 택배사 (사용자 선택 우선)
    const carrier = shippingInfo.carrier || getDefaultCarrier(order.channel);
    
    // 3. 각 주문별 배송 메모
    const orderNotes = order.notes || 
      `${order.customerName}님 주문 - 안전하게 배송하겠습니다.`;
    
    // 4. 공통 날짜 정보
    const shippingDate = shippingInfo.shippingDate || 
      new Date().toISOString().split('T')[0];
    const estimatedDelivery = shippingInfo.estimatedDelivery;
    
    console.log(`주문 ${order.orderNumber}:`, {
      trackingNumber: uniqueTrackingNumber,
      carrier,
      shippingDate,
      estimatedDelivery,
      notes: orderNotes
    });
    
    return orderApi.update(orderId, { status: OrderStatus.SHIPPED });
  });
  
  await Promise.all(updatePromises);
};
```

---

## 📋 테스트 시나리오

### ✅ 시나리오 1: 여러 주문 일괄 처리

**단계**:
1. 주문 3개 선택
2. 안내 메시지 확인
3. 운송장 번호/배송 메모 필드가 비활성화되었는지 확인
4. 택배사 선택: "CJ대한통운"
5. 배송일 선택: 오늘
6. "배송 시작 (3건)" 버튼 클릭
7. 브라우저 콘솔 확인

**예상 결과**:
- ✅ 콘솔에 3개의 서로 다른 운송장 번호가 로그됨
- ✅ 각 주문의 고객명이 포함된 배송 메모 생성
- ✅ 성공 메시지: "3건의 주문이 배송중 상태로 변경되었습니다. (각 주문마다 고유한 운송장 번호가 생성되었습니다)"

**콘솔 로그 예시**:
```javascript
주문 ORD-2025101501: {
  trackingNumber: "20251015123456",
  carrier: "CJ대한통운",
  shippingDate: "2025-10-15",
  estimatedDelivery: "2025-10-17",
  notes: "김민수님 주문 - 안전하게 배송하겠습니다."
}

주문 ORD-2025101502: {
  trackingNumber: "20251015847291",
  carrier: "CJ대한통운",
  shippingDate: "2025-10-15",
  estimatedDelivery: "2025-10-17",
  notes: "이지은님 주문 - 안전하게 배송하겠습니다."
}

주문 ORD-2025101503: {
  trackingNumber: "20251015965432",
  carrier: "CJ대한통운",
  shippingDate: "2025-10-15",
  estimatedDelivery: "2025-10-17",
  notes: "박상현님 주문 - 안전하게 배송하겠습니다."
}
```

### ✅ 시나리오 2: 전체 선택

**단계**:
1. "전체 선택" 버튼 클릭 (10개 주문)
2. 안내 메시지 확인: "10개 주문이 선택되었습니다..."
3. 택배사 선택: "한진택배"
4. "배송 시작 (10건)" 버튼 클릭
5. 콘솔 확인

**예상 결과**:
- ✅ 10개의 고유한 운송장 번호 생성
- ✅ 모든 주문에 "한진택배" 적용
- ✅ 각 주문의 고객명을 포함한 개별 메모 생성

### ✅ 시나리오 3: 채널별 택배사 테스트

**단계**:
1. 카페24 주문 1개 선택
2. 자동 생성된 택배사 확인: "CJ대한통운"
3. 추가로 네이버 주문 1개 선택 (총 2개)
4. 택배사 필드는 그대로 유지
5. "배송 시작" 클릭

**예상 결과**:
- ✅ 두 주문 모두 "CJ대한통운"으로 배송 시작
- ✅ 각각 고유한 운송장 번호 생성

### ✅ 시나리오 4: 단일 → 여러 → 단일 전환

**단계**:
1. 주문 1개 선택
2. 운송장 번호 자동 생성 확인 (활성화)
3. 추가 주문 선택 (총 2개)
4. 운송장 번호 필드 비활성화 확인
5. 첫 번째 주문 선택 해제 (1개만 남음)
6. 운송장 번호 필드 다시 활성화 확인

**예상 결과**:
- ✅ 주문 개수에 따라 UI가 동적으로 변경됨
- ✅ 필드 활성화/비활성화 올바르게 작동

---

## 💡 사용 팁

### 1. 채널이 다른 주문 일괄 처리
- 여러 채널의 주문을 한 번에 처리할 경우
- 택배사를 직접 선택하면 모든 주문에 동일하게 적용됨
- 예: 카페24, 네이버, 쿠팡 주문 선택 → "CJ대한통운" 선택 → 모두 CJ로 배송

### 2. 같은 채널 일괄 처리
- 같은 채널의 주문을 처리할 경우
- 택배사를 비워두면 각 주문의 채널 기본 택배사가 적용됨
- 예: 카페24 주문 5개 선택 → 모두 "CJ대한통운"으로 자동 설정

### 3. 공통 정보와 개별 정보
**공통 정보** (모든 주문에 동일하게 적용):
- 택배사
- 배송일
- 예상 배송일

**개별 정보** (각 주문마다 자동 생성):
- 운송장 번호
- 배송 메모 (고객명 포함)

---

## 🚀 다음 단계

### 백엔드 개선 필요
현재는 주문 상태만 업데이트하고, 운송장 정보는 콘솔에만 로그됩니다.

**TODO**: Order 엔티티에 운송장 정보 필드 추가
```java
// Order.java에 추가
@Column(name = "tracking_number")
private String trackingNumber;

@Column(name = "carrier")
private String carrier;

@Column(name = "shipping_date")
private LocalDate shippingDate;

@Column(name = "estimated_delivery")
private LocalDate estimatedDelivery;

@Column(name = "shipping_notes")
private String shippingNotes;
```

이 필드들이 추가되면:
- 운송장 정보가 데이터베이스에 저장됨
- 주문 상세 페이지에서 운송장 번호 확인 가능
- 배송 추적 기능 구현 가능

---

## 📊 개선 효과

### 시간 절약
- **이전**: 주문 10개 처리 시 각각 운송장 번호 입력 → 10~20분
- **현재**: 주문 10개 일괄 처리 → 1분 이내
- **절약**: 약 **90% 시간 단축**

### 오류 방지
- ✅ 운송장 번호 중복 불가능
- ✅ 각 주문이 고유한 번호를 가짐
- ✅ 고객명 오타 방지 (자동 생성)

### 편의성
- ✅ 클릭 몇 번으로 대량 처리
- ✅ 공통 정보만 입력하면 됨
- ✅ 개별 정보는 자동 생성

---

## 🧪 테스트 체크리스트

- [ ] 단일 주문 선택 시 정상 작동
- [ ] 여러 주문 선택 시 필드 비활성화
- [ ] 운송장 번호 필드 안내 메시지 표시
- [ ] 배송 메모 필드 안내 메시지 표시
- [ ] 여러 주문 배송 시 콘솔에 고유한 번호들 출력
- [ ] 각 주문의 고객명이 메모에 포함됨
- [ ] 선택한 택배사가 모든 주문에 적용됨
- [ ] 배송일/예상 배송일이 모든 주문에 적용됨
- [ ] 전체 선택 후 일괄 처리 작동
- [ ] 성공 메시지에 "고유한 운송장 번호" 문구 포함

---

**문서 버전**: 2.0  
**마지막 업데이트**: 2025년 10월 15일  
**중요도**: ⭐⭐⭐⭐⭐ (매우 중요한 업데이트)

